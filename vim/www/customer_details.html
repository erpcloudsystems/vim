<script src="https://code.jquery.com/jquery-3.5.1.js" type="text/javascript"></script>
<style>.form_img img{ height: 140px; width: 100%;}.page_content{width: 826px;margin: auto;background-color: snow;}#page-customer_details{background-color: #0ba3d5;margin-top: -15px;}.web-footer {padding: 0rem 0;}</style>
<div class="form_img"><img  src="https://www.cheekymonkeys.com/wp-content/uploads/2018/11/cm-form-logo1.png" ></div><br>
            <div class="row" style="border-bottom: 1px solid gainsboro;padding: 0 10px 0 10px;width: 100%;margin: auto;">
                <div class="col-md-6" style="font-size: 20px;" >Customer Family Details</div>
                <div class="col-md-6" style="text-align: end;"><button class="btn btn-primary" id='update'>Update</button> </div>
                <br><br>  
            </div>
            <br>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
                <div class="form-group col-md-6">
                    <div id="name"></div>
                    <label >First Name</label>
                    <input type="text" id="first_name" class="form-control" required autofocus>
                </div>
            
                <div class="form-group col-md-6">
                    <label >Last Name</label>
                    <input type="text" id="last_name" class="form-control" required >
                </div>
            </div>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
                <div class="form-group col-md-6" style="display: none;">
                    <label >Full Name</label>
                    <input type="text" id="customer_name" class="form-control" readonly >
                </div>
                <div class="form-group col-md-6">
                    <label for="exampleFormControlSelect1">Nationality</label>
                    <select class="form-control" id="nationality">
                        <option>Select</option>
                   
                  
                    </select>
                </div>
                 <div class="form-group col-md-6">
                    <label for="exampleFormControlSelect1">Preferred Communication</label>
                    <select class="form-control" id="preferred_communication">
                        <option>Select</option>
                  
                    </select>
                </div>
                <div class="form-group col-md-6" style="display: none;">
                    <label for="exampleFormControlSelect1">Customer Primary Contact</label>
                    <input type="text" id="customer_primary_contact" class="form-control" readonly >
                   
                </div>
                <div class="form-group col-md-6" style="position:absolute;">
                    <!-- <label >Country Code</label> -->
                </div>
            </div>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
               
                <div class="form-group col-md-6" >
                    <label >Mobile No</label>
                    <input type="text" id="country_code" class="form-control" style="position:absolute;width: 55px;top: 34px;" readonly >
                    <input type="text" id="mobile_no" class="form-control" style="width: 84%;margin-left: auto;" >
                </div>
                <div class="form-group col-md-6">
                    <label >Email Id</label>
                    <input type="text" id="email_id" class="form-control" readonly >
                </div>
            </div>
            <!-- <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
               
                <div class="form-group col-md-6">
                    <label for="exampleFormControlSelect1">Nationality</label>
                    <select class="form-control" id="nationality">
                        <option>Select</option>
                   
                  
                    </select>
                </div>
            </div> -->
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
                <div class="form-group col-md-6">
                    <label for="exampleFormControlSelect1">City</label>
                    <select class="form-control" id="city">
                        <option>Select</option>
                 
                  
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label >District</label>
                    <input type="text" id="district" class="form-control" readonly >
                </div>
                
            </div>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
              
                <div class="form-group col-md-6">
                    <label >Channel Used at registartion time</label>
                    <input type="text" id="channel_used_at_registartion_time" class="form-control" readonly >
                </div>
              
            </div>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
                <div class="form-group col-md-2">
                 
                    <button  class="form-control btn btn-primary" id='add_child' >Add Child</button>
                </div>
                
            </div>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
                <div class="col-md-12" style="width: 100%;overflow: auto;    border: 1px solid #dcd7d7e0;
                border-radius: 4px;"><br>
                      <table id="child_table" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>Sr No</th>
                                <th>Child Gender</th>
                                <th>Child Name</th>
                                <th>School Name</th>
                                <th>Favourite Character</th>
                                <th>Favourite Color</th>
                                <th>DOB</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody id='child_tbl_body'>
                         
                        </tbody>
                      
                    </table><br>
                </div>
            </div>

<br>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
                <div class="form-group col-md-2">
                 
                    <button   class="form-control btn btn-primary" id='add_adult' >Add Adult</button>
                </div>
                
            </div>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
                <div class="col-md-12" style="width: 100%;overflow: auto;    border: 1px solid #dcd7d7e0;
                border-radius: 4px;">
                    <table id="adult_table" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>Sr No</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Preferred Communication</th>
                                <th>Relation</th>
                                <th>Phone No</th>
                                <th>Email</th>
                                <th>DOB</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody id='adult_tbl_body'>
                            <!-- <tr>
                                <td class='srno'>1</td>
                                <td><input type="text" id="first_name" name="first_name" value="School"></td>
                                <td><input type="text" id="last_name" name="last_name" value="School"></td>
                                <td><select size="1" id="preferred_communication" name="preferred_communication">
                                    <option value="SMS" selected="selected"> SMS</option>
                                    <option value="London">Jerry</option>
                                </select></td>
                                <td><select size="1" id="relation" name="relation">
                                    <option value="Self" selected="selected">Self</option>
                                </select></td>
                                <td><input type="number" id='phone_no'></td>
                                <td><input type="email" id='email_id'></td>
                                <td><input type="date" id='dob'></td>
                            </tr>
                            <tr>
                                <td class='srno'>1</td>
                                <td><input type="text" id="first_name" name="first_name" value="School"></td>
                                <td><input type="text" id="last_name" name="last_name" value="School"></td>
                                <td><select size="1" id="preferred_communication" name="preferred_communication">
                                    <option value="SMS" selected="selected"> SMS</option>
                                    <option value="London">Jerry</option>
                                </select></td>
                                <td><select size="1" id="relation" name="relation">
                                    <option value="Self" selected="selected">Self</option>
                                </select></td>
                                <td><input type="number" id='phone_no'></td>
                                <td><input type="email" id='email_id'></td>
                                <td><input type="date" id='dob'></td>
                            </tr> -->
                        </tbody>
                    </table>
                 
                </div>
            </div>
            <br>
          
            <div class="row" style="border-top: 1px solid gainsboro;padding: 0 10px 0 10px;width: 100%;margin: auto;">
              
            </div>
            <br>
            <div class="row" style="padding: 0 10px 0 10px;width: 100%;margin: auto;">
                
                <div class="col-md-12" style="text-align: end;"><button class="btn btn-primary" id='update_bottom'>Update</button> </div>
               
            </div>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
<!-- <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js" type="text/javascript"></script> -->
<!-- <script href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"> -->
</script><script>
    var favcharlist=[],colorlist=[],relationlist=[],prefcommlist=[],countrylist=[],citylist=[],delete_list=[]
$(document).ready(function() {
    $.noConflict();
    var child_table = $('#child_table').DataTable({
        columnDefs: [{
            orderable: false,
            targets: [1,2,3]
        }],
        
    });
    var adult_table = $('#adult_table').DataTable({
        columnDefs: [{
            orderable: false,
            targets: [1,2,3],
        }]
    });
   
    get_data()
   
      $('#child_table').on("click", "a", function(){
            
            if($(this).attr("id") !=''){
            delete_list.push({'name':$(this).attr("id")})}
            child_table.row($(this).parents('tr')).remove().draw(false);
      });
      $('#adult_table').on("click", "a", function(){
           
            if($(this).attr("id") !=''){
            delete_list.push({'name':$(this).attr("id")})}
            adult_table.row($(this).parents('tr')).remove().draw(false);
      });
    $('#first_name').change(function(){
        console.log('ho')
        if($('#first_name').val() !=''){
            $('#customer_name').val($('#first_name').val() +' '+ $('#last_name').val())
        }
        
    })
    $('#last_name').change(function(){
        if($('#last_name').val() !=''){
            $('#customer_name').val($('#first_name').val() +' '+ $('#last_name').val())
        }
        
    })
    $('#add_child').click(function(){
        add_child()
    })
    $('#add_adult').click(function(){
        add_adult()
    })
    $('#mobile_no').change(function(){
        var adulttable=$('#adult_table').DataTable().rows().count()
        
        if(adulttable==1){
            $('#adult_table').DataTable().cell(0,5).nodes().to$().find('input').val($('#mobile_no').val())
            // if($('#adult_table').DataTable().cell(0,5).nodes().to$().find('input').val()==''){
            //     $('#adult_table').DataTable().cell(0,5).nodes().to$().find('input').val($('#mobile_no').val())
            // }
        }
    })
    $('#preferred_communication').change(function(){
        var adulttable=$('#adult_table').DataTable().rows().count()
        if(adulttable==1){
            if($('#adult_table').DataTable().cell(0,3).nodes().to$().find('select').val()==''){
                $('#adult_table').DataTable().cell(0,3).nodes().to$().find('select').val($('#preferred_communication').val())
            }
        }
    })
    $('#nationality').change(function(){
        nationality()
    })
    
    $('#city').change(function(){
        console.log($('#city').val(),'hi')
        frappe.call({
				method: "frappe.client.get_value",
				args: {
					doctype: "City",
					fieldname: ['district_name'],
					filters: { name:$('#city').val() },
				},
				callback: function (r, rt) {
					console.log(r.message,'city')
                      if(r.message){
                          $('#district').val(r.message['district_name'])
                      }
                    else{
                        $('#district').val('')
                    }
					
					
				}
			});
    })
    $('#update').click(function(){
        
        update_click()
    })
    $('#update_bottom').click(function(){
        update_click()
    })

})
function nationality(){
        frappe.call({
				method: "frappe.client.get_value",
				args: {
					doctype: "Country",
					
					fieldname: ['code'],
					filters: { name:$('#nationality').val() },
				},
				callback: function (r, rt) {
					console.log(r.message,'dfs')
                      if(r.message){
                          $('#country_code').val(r.message['code'])
                      }
                    else{
                        $('#country_code').val('')
                    }
					
					
				}
			});
    }
function add_adult(cust_details){
    var relationoption='',prefcommoption=''
    var length_adult=$('#adult_table').DataTable().rows().count() +1
    var count=0;
    if(cust_details){
        
        for(var i=0;i<cust_details.length;i++){
            
            if(cust_details[i]['adult']==1){
                count=count+1;
                if (relationlist){
                    
                    for(var j=0;j<relationlist.length;j++){
                        var selected_val=''
                        
                    if(relationlist[j]['name']==cust_details[i].relation){
                        
                                selected_val="selected='selected'"
                            }
                    if (relationoption=='')
                    {
                        relationoption="<option value=''>--Select--</option><option value='"+relationlist[j]['name']+"' "+selected_val+">"+relationlist[j]['name']+"</option>"
                    }
                    else{
                        relationoption=relationoption+"<option value='"+relationlist[j]['name']+"' "+selected_val+">"+relationlist[j]['name']+"</option>"
                    }
                }
                
            }
            if (prefcommlist){
        
            for(var j=0;j<prefcommlist.length;j++){
                var selected_com_val=''
                if(prefcommlist[j]['name']==cust_details[i].preferred_communication){
                        
                    selected_com_val="selected='selected'"
                            }
                if (prefcommoption=='')
                {
                    prefcommoption="<option value=''>--Select--</option><option value='"+prefcommlist[j]['name']+"' "+selected_com_val+">"+prefcommlist[j]['name']+"</option>"
                }
                else{
                    prefcommoption=prefcommoption+"<option value='"+prefcommlist[j]['name']+"' "+selected_com_val+">"+prefcommlist[j]['name']+"</option>"
                }
                }
            }
            var phone_no=''
            var email_id=''
            var first_name=''
            if(cust_details.length ==1){
                phone_no=cust_details[0]['phone_no']==null?$('#mobile_no').val():cust_details[0]['phone_no']
                first_name=cust_details[0]['first_name']==null?$('#first_name').val():cust_details[0]['first_name']
                last_name=cust_details[0]['last_name']==null?$('#last_name').val():cust_details[0]['last_name']
                email_id=cust_details[0]['email_id']==null?$('#email_id').val():cust_details[0]['email_id']
            }
            else{
                phone_no=cust_details[i]['phone_no']==null?'':cust_details[i]['phone_no']
                first_name=cust_details[i]['first_name']==null?'':cust_details[i]['first_name']
                last_name=cust_details[i]['last_name']==null?'':cust_details[i]['last_name']
                email_id=cust_details[i]['email_id']==null?'':cust_details[i]['email_id']
            }
                $('#adult_table').DataTable().row.add([count,"<input type='text' id='first_name' name='first_name' value='"+first_name+"'>",
                "<input type='text' id='last_name' name='last_name' value='"+(last_name)+"'>",
                "<select  id='preferred_communication' name='preferred_communication'>"+prefcommoption+"</select>",
                "<select  id='relation' name='relation'>"+relationoption +"</select>",
                "<input type='text' id='phone_no' value="+phone_no+">",
                "<input type='email' id='email_id' value='"+email_id+"''>",
                "<input type='date' id='dob' value='"+cust_details[i]['dob']+"''>",'<a href="#" id='+cust_details[i]['name']+'>Delete</a>',
                cust_details[i]['name']]).draw()
            }
        }
    }
    else{
            if (relationlist){
                    
                for(var j=0;j<relationlist.length;j++){
                
                if (relationoption=='')
                {
                    relationoption="<option value=''>--Select--</option><option value='"+relationlist[j]['name']+"' >"+relationlist[j]['name']+"</option>"
                }
                else{
                    relationoption=relationoption+"<option value='"+relationlist[j]['name']+"'>"+relationlist[j]['name']+"</option>"
                }
                }
                
            }
            console.log(relationlist,relationoption,'sdf')
            if (prefcommlist){
        
            for(var k=0;k<prefcommlist.length;k++){
                
                if (prefcommoption=='')
                {
                    prefcommoption="<option value=''>--Select--</option><option value='"+prefcommlist[k]['name']+"' >"+prefcommlist[k]['name']+"</option>"
                }
                else{
                    prefcommoption=prefcommoption+"<option value='"+prefcommlist[k]['name']+"' >"+prefcommlist[k]['name']+"</option>"
                }
            }
            }
        $('#adult_table').DataTable().row.add([length_adult,"<input type='text' id='first_name' name='first_name' value=''>",
                "<input type='text' id='last_name' name='last_name' value=''>",
                "<select  id='preferred_communication' name='preferred_communication'>"+prefcommoption+"</select>",
                "<select  id='relation' name='relation'>"+relationoption +"</select>",
                "<input type='text' id='phone_no' value=''>",
                "<input type='email' id='email_id' value=''>",
                "<input type='date' id='dob' value=''>",'<a href="#" id="">Delete</a>',
                'New']).draw()
    }
}
function add_child(cust_details){
    console.log(favcharlist)
    var favcharoption='',coloroption='',genderoption=''
    var count=0
    var length_child=$('#child_table').DataTable().rows().count() +1
    console.log(length_child,'ddf')
    if(cust_details){
        for(var i=0;i<cust_details.length;i++){
            if(cust_details[i]['child']==1){
                count=count+1
                if (favcharlist){
                   
                for(var j=0;j<favcharlist.length;j++){
                    var selected_val=''
                    if(favcharlist[j]['name']==cust_details[i]['favorite_character']){
                        selected_val="selected='selected'"
                    }
                    if (favcharoption=='')
                    {
                        favcharoption="<option value=''>--Select--</option><option value='"+favcharlist[j]['name']+"' "+selected_val+">"+favcharlist[j]['name']+"</option>"
                    }
                    else{
                        favcharoption=favcharoption+"<option value='"+favcharlist[j]['name']+"' "+selected_val+">"+favcharlist[j]['name']+"</option>"
                    }
                }
        
            }
            
            if (colorlist){
                
                for(var l=0;l<colorlist.length;l++){
                    var selected_col_val=''
                    console.log(cust_details[i]['favourite_colour'],'dsf')
                    if(colorlist[l]['name']==cust_details[i]['favourite_colour']){
                        
                        selected_col_val="selected='selected'"
                        console.log(colorlist[l]['name'],cust_details[i]['favourite_colour'],selected_col_val)
                    }
                    if (coloroption=='')
                    {
                        coloroption="<option value=''>--Select--</option><option value='"+colorlist[l]['name']+"' "+selected_col_val+">"+colorlist[l]['name']+"</option>"
                    }
                    else{
                        coloroption=coloroption+"<option value='"+colorlist[l]['name']+"' "+selected_col_val+">"+colorlist[l]['name']+"</option>"
                    }
                }
                
            }
            
            var gender_list=[]
            gender_list.push({"name":'Girl'})
            gender_list.push({'name':'Boy'})
            for(var k=0;k<gender_list.length;k++){
                console.log(gender_list[k].name)
                var selected_gender=''
                if(gender_list[k]['name']==cust_details[i]['gender']){
                    selected_gender="selected='selected'"
                    }
                if (genderoption=='')
                {
                    genderoption="<option value=''>--Select--</option><option value='"+gender_list[k]['name']+"' "+selected_gender+">"+gender_list[k]['name']+"</option>"
                }
                else{
                    genderoption=genderoption+"<option value='"+gender_list[k]['name']+"' "+selected_gender+">"+gender_list[k]['name']+"</option>"
                }  

            }
             
                
                $('#child_table').DataTable().row.add([count,
                "<select  id='gender' name='gender'>"+genderoption+"</select>",
                "<input type='text' id='child_name' name='child_name' value='"+cust_details[i]['child_name']+"'>",
                "<input type='text' id='school_name' name='school_name' value='"+cust_details[i]['school_name']+"'>",
                "<select  id='favourite_character' name='favourite_character'>"+favcharoption +"</select>",
                "<select  id='favourite_colour' name='favourite_colour'>"+coloroption +"</select>",
                "<input type='date' id='dob' value='"+cust_details[i]['dob']+"''>",'<a href="#" id='+cust_details[i]['name']+'>Delete</a>',cust_details[i]['name']]).draw()
            }
        }
    }
    else{
        for(var j=0;j<favcharlist.length;j++){
                  
            if (favcharoption=='')
            {
                favcharoption="<option value=''>--Select--</option><option value='"+favcharlist[j]['name']+"' >"+favcharlist[j]['name']+"</option>"
            }
            else{
                favcharoption=favcharoption+"<option value='"+favcharlist[j]['name']+"' >"+favcharlist[j]['name']+"</option>"
            }
                }
        for(var j=0;j<colorlist.length;j++){
            
            if (coloroption=='')
            {
                coloroption="<option value=''>--Select--</option><option value='"+colorlist[j]['name']+"' >"+colorlist[j]['name']+"</option>"
            }
            else{
                coloroption=coloroption+"<option value='"+colorlist[j]['name']+"' >"+colorlist[j]['name']+"</option>"
            }
        }
        var gender_list=[]
            gender_list.push({"name":'Girl'})
            gender_list.push({'name':'Boy'})
            for(var k=0;k<gender_list.length;k++){
                console.log(gender_list[k].name)
                
                if (genderoption=='')
                {
                    genderoption="<option value=''>--Select--</option><option value='"+gender_list[k]['name']+"' >"+gender_list[k]['name']+"</option>"
                }
                else{
                    genderoption=genderoption+"<option value='"+gender_list[k]['name']+"' "+selected_gender+">"+gender_list[k]['name']+"</option>"
                }  

            }
                  
        $('#child_table').DataTable().row.add([length_child,
                "<select  id='gender' name='gender'>"+genderoption+"</select>",
                "<input type='text' id='child_name' name='child_name' value=''>",
                "<input type='text' id='school_name' name='school_name' value=''>",
                "<select  id='favourite_character' name='favourite_character'>"+favcharoption +"</select>",
                "<select  id='favourite_colour' name='favourite_colour'>"+coloroption +"</select>",
                "<input type='date' id='dob' value=''>",'<a href="#" id="">Delete</a>',"New"]).draw()
    }

}
function get_data(){
    
    frappe.call({
            method: "vim.www.customer_details.get_customer_Detail",
            async: false,
                args: {
                },
            callback: function (r) {
                data=r.message;
                if(data){
                    var parameters = location.search.substring(1).split("&");
                    var temp = parameters[0].split("=");
                    console.log(temp)
                    if(temp[0]==''){
                        window.location='/customer_details?name='+data['customer'].name
                    }	
                    var customer=data['customer']
                    var cust_details=data['cust_details']
                    var contact=data['contact']
                    var user=data['user_data']
                    favcharlist=data['fav_char']
                    colorlist=data['color']
                    prefcommlist=data['preferred_communication']
                    relationlist=data['relation']
                    countrylist=data['country']
                    citylist=data['city']
                    var pref_comm = $("#preferred_communication");
                    pref_comm.empty();
                    pref_comm.append($("<option></option>").val("").html("--Select--"));
                    for(var i=0;i<prefcommlist.length;i++){
                        pref_comm.append($("<option></option>").val(prefcommlist[i]['name']).html(prefcommlist[i]['name']));
                    }
                    var nationality = $("#nationality");
                    nationality.empty();
                    nationality.append($("<option></option>").val("").html("--Select--"));
                    for(var i=0;i<countrylist.length;i++){
                        nationality.append($("<option></option>").val(countrylist[i]['name']).html(countrylist[i]['name']));
                    }
                    var city = $("#city");
                    city.empty();
                    city.append($("<option></option>").val("").html("--Select--"));
                    for(var i=0;i<citylist.length;i++){
                        city.append($("<option></option>").val(citylist[i]['name']).html(citylist[i]['name']));
                    }
                    set_customer_data(customer,cust_details,contact,user)
                }
                else{
                    alert('Login First !!')
                    window.location = window.location.origin
                }
                
            }
        });
}
function set_customer_data(customer_data,cust_details,contact,user){
    if(contact && customer_data['is_first_time_login']==0){
        
        
        // $('#country_code').val('+966')
        var name=user['full_name'],first_name='',lname='';
        const arry=name.split(" ")
        first_name=arry[0];
        
        for(var i=1;i<arry.length;i++){
            if(lname==''){
                lname=arry[i];
            }
            else{
                lname=lname+' '+arry[i];
            }
        }
        console.log(lname,first_name,name,'sdds')
        $('#first_name').val(first_name)
        $('#last_name').val(lname.toString())
        $('#customer_name').val(name)
        $('#customer_primary_contact').val(contact[0].contact_name)
        // $('#first_name').val(user['first_name'])
        // $('#last_name').val(user['last_name'])
        // $('#customer_name').val(user['first_name'])
        $('#mobile_no').val(user['mobile_no'])
        $('#email_id').val(user['name'])
        $('#nationality').val('Saudi Arabia')
        nationality()
        // $('#country_code').val('+966')
    }
    $('#name').val(customer_data['name'])
    if(customer_data['is_first_time_login']==1){
        $('#customer_primary_contact').val(customer_data['customer_primary_contact'])
        $('#first_name').val(customer_data['first_name'])
        $('#last_name').val(customer_data['last_name'])
        $('#customer_name').val(customer_data['customer_name'])
        $('#country_code').val(customer_data['country_code'])
        $('#mobile_no').val(customer_data['mobile_no'])
        $('#email_id').val(customer_data['email_id'])
        $('#nationality').val(customer_data['nationality'])
        $('#district').val(customer_data['district'])
        $('#preferred_communication').val(customer_data['preferred_communication'])
    }
    
    if($('#mobile_no').val()==''){
        $('#mobile_no').prop('readonly', false);
    }else{
        $('#mobile_no').prop('readonly', true);
    }
    $('#channel_used_at_registartion_time').val('Online Registration')
    $('#city').val(customer_data['city'])
    
    add_adult(cust_details)
    add_child(cust_details)
    // $('#adult_table').DataTable().cell(0,3).nodes().to$().find('select').val()
}
function update_click(){
    var array_customer=[]
        var _return=true
        if($('#first_name').val()==''){
            alert('please enter first name')
            _return=false
            return;
        }
        if($('#last_name').val()==''){
            alert('please enter last name')
            _return=false
            return;
        }
        if($('#mobile_no').val()==''){
            alert('please enter mobile no')
            _return=false
            return;
        }
        if($('#city').val()==''){
            alert('please enter city')
            _return=false
            return;
        }
        if(_return==true){
            array_customer.push({
            'name':$('#name').val(),
            'first_name':$('#first_name').val(),
            'last_name':$('#last_name').val(),
            'customer_name':$('#customer_name').val(),
            'country_code':$('#country_code').val(),
            'mobile_no':$('#mobile_no').val(),
            'email_id':$('#email_id').val(),
            'channel_used_at_registartion_time':$('#channel_used_at_registartion_time').val(),
            'city':$('#city').val(),
            'nationality':$('#nationality').val(),
            'preferred_communication':$('#preferred_communication').val(),
            'is_first_time_login':1,
            'customer_primary_contact':$('#customer_primary_contact').val(),
            'district':$('#district').val()
        })
        var arry_adult=[]
        var adulttable=$('#adult_table').DataTable().rows().count()
        for(var i=0;i<adulttable;i++){
            if($('#adult_table').DataTable().cell(i,1).nodes().to$().find('input').val()==''){
                alert('Enter First name in row('+$('#adult_table').DataTable().data()[i][0]+')')
                _return=false;
                return;
            }
            if($('#adult_table').DataTable().cell(i,2).nodes().to$().find('input').val()==''){
                alert('Enter Last name in row('+$('#adult_table').DataTable().data()[i][0]+')')
                _return=false;
                return;
            }
            console.log($('#adult_table').DataTable().data()[i][9],'sdf')
            
            if(_return==true){
                arry_adult.push({'sr_no':$('#adult_table').DataTable().data()[i][0],
                'first_name':$('#adult_table').DataTable().cell(i,1).nodes().to$().find('input').val(),
                'last_name':$('#adult_table').DataTable().cell(i,2).nodes().to$().find('input').val(),
                'preferred_communication':$('#adult_table').DataTable().cell(i,3).nodes().to$().find('select').val(),
                'relation':$('#adult_table').DataTable().cell(i,4).nodes().to$().find('select').val(),
                'phone_no':$('#adult_table').DataTable().cell(i,5).nodes().to$().find('input').val(),
                'email_id':$('#adult_table').DataTable().cell(i,6).nodes().to$().find('input').val(),
                'dob':$('#adult_table').DataTable().cell(i,7).nodes().to$().find('input').val(),
                'name':$('#adult_table').DataTable().data()[i][9]
            })
            }
            
        }
        var arry_child=[]
        var childtable=$('#child_table').DataTable().rows().count()
        for(var j=0;j<childtable;j++){
            if($('#child_table').DataTable().cell(j,1).nodes().to$().find('select').val()==''){
                alert('Enter Child name in row('+$('#child_table').DataTable().data()[j][0]+')')
                _return=false;
                return;
            }
            if(_return==true){
                arry_child.push({
                'sr_no':$('#child_table').DataTable().data()[j][0],
                'gender':$('#child_table').DataTable().cell(j,1).nodes().to$().find('select').val(),
                'child_name':$('#child_table').DataTable().cell(j,2).nodes().to$().find('input').val(),
                'school_name':$('#child_table').DataTable().cell(j,3).nodes().to$().find('input').val(),
                'favourite_character':$('#child_table').DataTable().cell(j,4).nodes().to$().find('select').val(),
                'favourite_color':$('#child_table').DataTable().cell(j,5).nodes().to$().find('select').val(),
                'dob':$('#child_table').DataTable().cell(j,6).nodes().to$().find('input').val(),
                'name':$('#child_table').DataTable().data()[j][8]
            }) 
            }
            
        }
        if(_return==true){
            frappe.call({
            method: "vim.www.customer_details.update",
            async: false,
                args: {
                    'customer_array':array_customer,
                    'arry_adult':arry_adult,
                    'arry_child':arry_child,
                    'delete_list':delete_list
                },
            callback: function (r) {
                window.location = window.location.origin
            }})
        }
        }
       
}
</script>